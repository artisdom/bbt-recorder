'use strict';var app=new Vue({el:'#app',data:{records:[],pages:0,selectedRecord:[]},watch:{pages:function pages(){setTimeout(function(){var a=$('#pagination').children(),b=a[1];b.className='active light-blue',3==a.length&&(last=a[2],last.className='disabled')},50)},records:function records(){app.pages=Math.ceil(app.records.length/10),navigationManager(pageNow)}},methods:{nextPage:function nextPage(){navigationManager(pageNow+1)},forwardPage:function forwardPage(){navigationManager(pageNow-1)},changePage:function(a){navigationManager(a)},playRecord:function playRecord(a,b){_playRecord(a,b)},stopPlayRecord:function stopPlayRecord(a,b){_stopPlayRecord(a,b)},deleteRecord:function deleteRecord(a){_deleteRecord(a)}}});String.prototype.includes||(String.prototype.includes=function(a,b){'use strict';return'number'!=typeof b&&(b=0),!(b+a.length>this.length)&&-1!==this.indexOf(a,b)});var audioPlayer=document.getElementById('audioPlayer'),lastPlayDOM;audioPlayer.addEventListener('ended',function(){lastPlayDOM.parentElement.classList.remove('stop'),lastPlayDOM.parentElement.classList.add('play')});var _playRecord=function(a,b){audioPlayer.paused||_stopPlayRecord(),lastPlayDOM=a.target,lastPlayDOM.parentElement.classList.remove('play'),lastPlayDOM.parentElement.classList.add('stop'),audioPlayer.src=app.records[b].url,audioPlayer.play()},_stopPlayRecord=function(){audioPlayer.pause(),lastPlayDOM.parentElement.classList.remove('stop'),lastPlayDOM.parentElement.classList.add('play')},getRecords=function(){$.ajax({method:'GET',dataType:'json',url:'https://withcic.cn/apps/upload/index.php?show',success:function success(a){if(1==a.status){for(var d,b=[],c=0;c<a.respond.length;c++)d=a.respond[c],d.regtime=moment.unix(d.regtime).format('YYYY\u5E74MM\u6708DD\u65E5 HH:MM:SS'),d.displayId=c,d.url='https://withcic.cn/apps/upload/recordfiles/'+d.url.replace('silk','mp3'),b.push(d);app.records=b}else Materialize.toast(a.message,4e3)},error:function error(a){Materialize.toast(a.responseText,4e3)}})},_deleteRecord=function(a){$.ajax({method:'POST',url:'https://withcic.cn/apps/upload/index.php?delete=1',contentType:'application/x-www-form-urlencoded;charset=utf-8',data:'id='+app.records[a].id,dataType:'json',success:function success(b){1==b.status?(Materialize.toast('\u5220\u9664\u6210\u529F',4e3),app.records.splice(a,1)):Materialize.toast(b.message,4e3)},error:function error(b){Materialize.toast(b.responseText,4e3)}})},pageNow=1,changePage=function(a){if(app.selectedRecord=[],1==a)for(var c=0;10>c&&c<app.records.length;c++)app.selectedRecord.push(app.records[c]);else for(var b=10*(a-1),d=b;d<b+10&&d<app.records.length;d++)app.selectedRecord.push(app.records[d])},navigationManager=function(b){setTimeout(function(){var c=$('#pagination').children();b>app.pages&&(b=app.pages);0==b||(1==b?3==c.length||(c[app.pages+1].className='waves-effect pointer',c[0].className='disabled pointer'):b==app.pages?3==c.length||(c[0].className='waves-effect pointer',c[app.pages+1].className='disabled pointer'):3==c.length||(c[0].className='waves-effect pointer',c[app.pages+1].className='waves-effect pointer'),c[pageNow].className='wave-effect pointer',c[b].className='active light-blue pointer',pageNow=b,changePage(b))},50)};getRecords(),document.getElementById('logoutButton').addEventListener('click',function(){$.ajax({method:'GET',url:'https://withcic.cn/apps/upload/index.php?logout',dataType:'json',success:function success(a){1==a.status?window.location.href='./index.html':Materialize.toast(a.message,4e3)},error:function error(a){Materialize.toast(a.responseText,4e3)}})});